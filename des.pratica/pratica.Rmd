---
title: "Prática"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Esse tutorial tem como objetivo reproduzir o artigo "As horas de trabalho doméstico de homens e mulheres do Brasil" produzido por Gabriel Zanlorenssi e Rodolfo Almeida no Jornal Nexo. Você pode acessar esse arquivo pelo [site](https://www.nexojornal.com.br/grafico/2018/04/30/As-horas-de-trabalho-dom%C3%A9stico-de-homens-e-mulheres-do-Brasil).

Antes de iniciarmos o processo, crie um projeto dentro do RStudio. Para isso, navegue até a aba __File__ e depois selecione __Open Project__.

## Download e Organização

Vamos começar organizando os nossos dados. Primeiro, precisamos baixar a PNAD contínua do ano de 2017 no site do IBGE. Além disso, precisamos do dicionário de variáveis já que o nosso banco vem em _fixed width format_ e nesse dicionário existem algumas informações necessárias para que o R possa ler esse arquivo. 

Carregue as bibliotecas `tidyverse` e `readxl`.

```{r}
rm(list = ls())

library(tidyverse)
library(readxl)
```

Agora, temos duas opões: ou você baixa na mão o banco e o dicionário, ou você utiliza o R para realizar essa operação. É sempre mais interessante criar um _script_ completo, isto é, que rode do começo ao fim sem necessidade de intervenção humana. Contudo, o site do IBGE possui uma dinâmica um pouco mais complexa do que outros sites e é mais fácil apenas baixar os bancos desejados manualmente.

Entre no [site](https://www.ibge.gov.br/estatisticas-novoportal/sociais/trabalho/17270-pnad-continua.html?=&t=o-que-e) do IBGE. Selecione, na aba esquerda, a opção __Downloads__. Em seguida, siga o seguinte caminho: Anual > Microdados. Temos duas pastas: uma com nome Dados e outra com o nome Documentação. Na primeira, faça o download de __PNAD_2017_entr5.zip__. Na segunda, baixe __dicionario_PNAD_CONTINUA_MICRODADOS_5_visita_2017.xls__. Coloque os dois arquivos no diretório do R.

Dentro de __PNAD_2017_entr5.zip__ extraria o arquivo __PNADC_2017_entr5.txt__.

O processo realizado a seguir é um pouco complexo e foge do padrão de outras extenções como .csv, .xlsx, .dta ou .sav. Sabendo disso, caso sinta dificuldade fique a vontade para apenas rodar os códigos e seguir adiante para a próxima seção.

A leitura de arquivos em _fixed width format_ requer não só o arquivo com os dados, mas um outro que forneça o caminho, a posição, de cada variável. Para isso, nós utilizaremos o dicionário de variáveis da PNAD. Nesse arquivo, há três informações muito importantes: a posição inicial, o tamanho e o código da variável. 

Vamos começar extraindo essas três informações do dicionário.

```{r}
input <- read_xls("dicionario_PNAD_CONTINUA_MICRODADOS_5_visita_2017.xls", col_names = FALSE, skip = 4) %>% 
  rename(start     = X__1,
         tamanho   = X__2,
         col_names = X__3) %>% 
  select(start, tamanho, col_names)
```

Repare que utilizamos o parâmetro `col_names = FALSE` e `skip = 4`. O primeiro serve para informar a função `read_xls` que o nosso banco não possui nome de colunas. O segundo faz com que a função pule as quatro primeiras linhas já que elas não possuem informação relevante. Em seguinda, utilizamos a função `rename` para renomear as três primeiras colunas com nomes mais intuitivos. A função `select` seleciona apenas as três colunas desejadas.

```{r}
input <- input %>% 
  mutate(start = as.numeric(start)) %>% 
  filter(!is.na(start))

input <- input %>% 
  mutate(end = start + tamanho - 1)

input <- input %>% 
  select(start, end, col_names)
```

```{r}

colluns <- fwf_positions(start = input$start, end = input$end, col_names = input$col_names)

data <- read_fwf("PNADC_2017_entr5.txt", colluns)


```

